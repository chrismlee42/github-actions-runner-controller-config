apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
metadata:
  name: github-actions-runner-controller-config

commonLabels:
  app: github-actions-runner-controller
  managedBy: argocd
  managementCodeGroup: chrismlee42
  managementCodeProject: github-actions-runner-controller-config

namespace: github-actions-runner-controller

patches:
  - patch: |-
      - op: replace
    target:
      kind: Deployment

  - patch: |-
      - op: remove
        path: /spec/preserveUnknownFields
    target:
      kind: CustomResourceDefinition
      name: autoscalinglisteners.actions.github.com
  - patch: |-
      - op: remove
        path: /spec/preserveUnknownFields
    target:
      kind: CustomResourceDefinition
      name: autoscalingrunnersets.actions.github.com
  - patch: |-
      - op: remove
        path: /spec/preserveUnknownFields
    target:
      kind: CustomResourceDefinition
      name: ephemeralrunners.actions.github.com
  - patch: |-
      - op: remove
        path: /spec/preserveUnknownFields
    target:
      kind: CustomResourceDefinition
      name: ephemeralrunnersets.actions.github.com

resources:
  # https://github.com/actions/actions-runner-controller/releases
  # - https://github.com/actions/actions-runner-controller/releases/download/gha-runner-scale-set-0.13.0/actions-runner-controller.yaml
  - github-config-secret.yaml
  - namespace.yaml
